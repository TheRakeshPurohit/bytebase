# Path to sources
sonar.sources=.

# Exclude generated code, build artifacts, and dependencies from analysis
sonar.exclusions=\
  backend/generated-go,\
  backend/migrator/migration,\
  proto/gen,\
  bytebase-build,\
  frontend/node_modules

# Path to tests — identify test files so they are analyzed as tests, not source
sonar.test.inclusions=\
  backend/**/*_test.go,\
  backend/**/testdata/**,\
  backend/**/test-data/**,\
  backend/common/testcontainer/**,\
  backend/tests/**,\
  frontend/src/**/*.test.ts,\
  frontend/src/**/*.test.tsx,\
  frontend/src/**/*.spec.ts,\
  frontend/src/**/*.spec.tsx

# Source encoding
sonar.sourceEncoding=UTF-8

# Suppress false-positive security hotspots that travel with the codebase.
# These have been triaged and confirmed safe. Using sonar.issue.ignore so
# any fork or downstream SonarCloud scan also benefits.
sonar.issue.ignore.multicriteria=fp_sync_sql,fp_route_creds,fp_stats_explain,fp_dump_sql,fp_role_sql

# go:S2077 (SQL Injection) in db plugin sync.go files.
# These files query system catalogs (information_schema, pg_catalog, sys.*) using
# only hardcoded constants (SystemSchemaWhereClause) or server-side config values
# (d.databaseName from the Bytebase instance registry). No user input flows in.
sonar.issue.ignore.multicriteria.fp_sync_sql.ruleKey=go:S2077
sonar.issue.ignore.multicriteria.fp_sync_sql.resourceKey=backend/plugin/db/*/sync.go

# typescript:S2068 (Hard-coded credentials) in frontend router auth.ts.
# Route name constants (e.g., "auth.password.reset") contain the word "password"
# as part of the feature name, not actual credentials.
sonar.issue.ignore.multicriteria.fp_route_creds.ruleKey=typescript:S2068
sonar.issue.ignore.multicriteria.fp_route_creds.resourceKey=frontend/src/router/auth.ts

# go:S2077 (SQL Injection) in stats.go files (CountAffectedRows).
# These run EXPLAIN on user-authored SQL by design — Bytebase is a database
# change management tool and the user already has execution privileges.
sonar.issue.ignore.multicriteria.fp_stats_explain.ruleKey=go:S2077
sonar.issue.ignore.multicriteria.fp_stats_explain.resourceKey=backend/plugin/db/*/stats.go

# go:S2077 (SQL Injection) in db plugin dump.go files.
# These use d.databaseName from server-side config (Bytebase instance registry)
# in SHOW CREATE / GET_DDL / USE commands. Not user-supplied input.
sonar.issue.ignore.multicriteria.fp_dump_sql.ruleKey=go:S2077
sonar.issue.ignore.multicriteria.fp_dump_sql.resourceKey=backend/plugin/db/*/dump.go

# go:S2077 (SQL Injection) in db plugin role.go files.
# These use SHOW GRANTS with user/host values from mysql.user or
# information_schema.user_attributes system catalog tables. Not user input.
sonar.issue.ignore.multicriteria.fp_role_sql.ruleKey=go:S2077
sonar.issue.ignore.multicriteria.fp_role_sql.resourceKey=backend/plugin/db/*/role.go

# Exclusions for copy-paste detection
sonar.cpd.exclusions=\
  backend/**/*_test.go,\
  backend/**/testdata/**,\
  backend/**/test-data/**,\
  backend/generated-go,\
  backend/plugin/db/**,\
  frontend/src/**/*.test.ts,\
  frontend/src/**/*.test.tsx,\
  proto/gen
